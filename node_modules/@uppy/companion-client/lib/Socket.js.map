{"version":3,"names":["ee","Symbol","for","UppySocket","constructor","opts","e","message","JSON","parse","data","emit","action","payload","err","console","log","autoOpen","open","isOpen","WebSocket","target","onopen","length","first","shift","send","onclose","onmessage","close","push","stringify","on","handler","once"],"sources":["Socket.js"],"sourcesContent":["import ee from 'namespace-emitter'\n\nexport default class UppySocket {\n  #queued = []\n\n  #emitter = ee()\n\n  #isOpen = false\n\n  #socket\n\n  constructor (opts) {\n    this.opts = opts\n\n    if (!opts || opts.autoOpen !== false) {\n      this.open()\n    }\n  }\n\n  get isOpen () { return this.#isOpen }\n\n  [Symbol.for('uppy test: getSocket')] () { return this.#socket }\n\n  [Symbol.for('uppy test: getQueued')] () { return this.#queued }\n\n  open () {\n    if (this.#socket != null) return\n\n    this.#socket = new WebSocket(this.opts.target)\n\n    this.#socket.onopen = () => {\n      this.#isOpen = true\n\n      while (this.#queued.length > 0 && this.#isOpen) {\n        const first = this.#queued.shift()\n        this.send(first.action, first.payload)\n      }\n    }\n\n    this.#socket.onclose = () => {\n      this.#isOpen = false\n      this.#socket = null\n    }\n\n    this.#socket.onmessage = this.#handleMessage\n  }\n\n  close () {\n    this.#socket?.close()\n  }\n\n  send (action, payload) {\n    // attach uuid\n\n    if (!this.#isOpen) {\n      this.#queued.push({ action, payload })\n      return\n    }\n\n    this.#socket.send(JSON.stringify({\n      action,\n      payload,\n    }))\n  }\n\n  on (action, handler) {\n    this.#emitter.on(action, handler)\n  }\n\n  emit (action, payload) {\n    this.#emitter.emit(action, payload)\n  }\n\n  once (action, handler) {\n    this.#emitter.once(action, handler)\n  }\n\n  #handleMessage = (e) => {\n    try {\n      const message = JSON.parse(e.data)\n      this.emit(message.action, message.payload)\n    } catch (err) {\n      // TODO: use a more robust error handler.\n      console.log(err) // eslint-disable-line no-console\n    }\n  }\n}\n"],"mappings":";;;;;;;;AAAA,OAAOA,EAAP,MAAe,mBAAf;;;;;;;;;;;;cAqBGC,MAAM,CAACC,GAAP,CAAW,sBAAX,C;eAEAD,MAAM,CAACC,GAAP,CAAW,sBAAX,C;AArBH,eAAe,MAAMC,UAAN,CAAiB;EAS9BC,WAAW,CAAEC,IAAF,EAAQ;IAAA;MAAA;MAAA,OART;IAQS;IAAA;MAAA;MAAA,OANRL,EAAE;IAMM;IAAA;MAAA;MAAA,OAJT;IAIS;IAAA;MAAA;MAAA;IAAA;IAAA;MAAA;MAAA,OAkEDM,CAAD,IAAO;QACtB,IAAI;UACF,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWH,CAAC,CAACI,IAAb,CAAhB;UACA,KAAKC,IAAL,CAAUJ,OAAO,CAACK,MAAlB,EAA0BL,OAAO,CAACM,OAAlC;QACD,CAHD,CAGE,OAAOC,GAAP,EAAY;UACZ;UACAC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EAFY,CAEK;QAClB;MACF;IA1EkB;IACjB,KAAKT,IAAL,GAAYA,IAAZ;;IAEA,IAAI,CAACA,IAAD,IAASA,IAAI,CAACY,QAAL,KAAkB,KAA/B,EAAsC;MACpC,KAAKC,IAAL;IACD;EACF;;EAES,IAANC,MAAM,GAAI;IAAE,mCAAO,IAAP;EAAqB;;EAErC,gBAAwC;IAAE,mCAAO,IAAP;EAAqB;;EAE/D,iBAAwC;IAAE,mCAAO,IAAP;EAAqB;;EAE/DD,IAAI,GAAI;IACN,IAAI,uDAAgB,IAApB,EAA0B;IAE1B,sDAAe,IAAIE,SAAJ,CAAc,KAAKf,IAAL,CAAUgB,MAAxB,CAAf;;IAEA,oDAAaC,MAAb,GAAsB,MAAM;MAC1B,sDAAe,IAAf;;MAEA,OAAO,oDAAaC,MAAb,GAAsB,CAAtB,gCAA2B,IAA3B,mBAAP,EAAgD;QAC9C,MAAMC,KAAK,GAAG,oDAAaC,KAAb,EAAd;;QACA,KAAKC,IAAL,CAAUF,KAAK,CAACZ,MAAhB,EAAwBY,KAAK,CAACX,OAA9B;MACD;IACF,CAPD;;IASA,oDAAac,OAAb,GAAuB,MAAM;MAC3B,sDAAe,KAAf;MACA,sDAAe,IAAf;IACD,CAHD;;IAKA,oDAAaC,SAAb,+BAAyB,IAAzB;EACD;;EAEDC,KAAK,GAAI;IAAA;;IACP,uHAAcA,KAAd;EACD;;EAEDH,IAAI,CAAEd,MAAF,EAAUC,OAAV,EAAmB;IACrB;IAEA,IAAI,6BAAC,IAAD,mBAAJ,EAAmB;MACjB,oDAAaiB,IAAb,CAAkB;QAAElB,MAAF;QAAUC;MAAV,CAAlB;;MACA;IACD;;IAED,oDAAaa,IAAb,CAAkBlB,IAAI,CAACuB,SAAL,CAAe;MAC/BnB,MAD+B;MAE/BC;IAF+B,CAAf,CAAlB;EAID;;EAEDmB,EAAE,CAAEpB,MAAF,EAAUqB,OAAV,EAAmB;IACnB,sDAAcD,EAAd,CAAiBpB,MAAjB,EAAyBqB,OAAzB;EACD;;EAEDtB,IAAI,CAAEC,MAAF,EAAUC,OAAV,EAAmB;IACrB,sDAAcF,IAAd,CAAmBC,MAAnB,EAA2BC,OAA3B;EACD;;EAEDqB,IAAI,CAAEtB,MAAF,EAAUqB,OAAV,EAAmB;IACrB,sDAAcC,IAAd,CAAmBtB,MAAnB,EAA2BqB,OAA3B;EACD;;AAzE6B"}