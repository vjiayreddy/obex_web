{"version":3,"names":["getFileType","encodeCharacter","character","charCodeAt","toString","encodeFilename","name","suffix","replace","generateFileID","file","id","toLowerCase","type","undefined","meta","relativePath","data","size","lastModified","hasFileStableId","isRemote","remote","stableIdProviders","Set","has","provider","getSafeFileId","fileType"],"sources":["generateFileID.js"],"sourcesContent":["import getFileType from './getFileType.js'\n\nfunction encodeCharacter (character) {\n  return character.charCodeAt(0).toString(32)\n}\n\nfunction encodeFilename (name) {\n  let suffix = ''\n  return name.replace(/[^A-Z0-9]/ig, (character) => {\n    suffix += `-${encodeCharacter(character)}`\n    return '/'\n  }) + suffix\n}\n\n/**\n * Takes a file object and turns it into fileID, by converting file.name to lowercase,\n * removing extra characters and adding type, size and lastModified\n *\n * @param {object} file\n * @returns {string} the fileID\n */\nexport default function generateFileID (file) {\n  // It's tempting to do `[items].filter(Boolean).join('-')` here, but that\n  // is slower! simple string concatenation is fast\n\n  let id = 'uppy'\n  if (typeof file.name === 'string') {\n    id += `-${encodeFilename(file.name.toLowerCase())}`\n  }\n\n  if (file.type !== undefined) {\n    id += `-${file.type}`\n  }\n\n  if (file.meta && typeof file.meta.relativePath === 'string') {\n    id += `-${encodeFilename(file.meta.relativePath.toLowerCase())}`\n  }\n\n  if (file.data.size !== undefined) {\n    id += `-${file.data.size}`\n  }\n  if (file.data.lastModified !== undefined) {\n    id += `-${file.data.lastModified}`\n  }\n\n  return id\n}\n\n// If the provider has a stable, unique ID, then we can use that to identify the file.\n// Then we don't have to generate our own ID, and we can add the same file many times if needed (different path)\nfunction hasFileStableId (file) {\n  if (!file.isRemote || !file.remote) return false\n  // These are the providers that it seems like have stable IDs for their files. The other's I haven't checked yet.\n  const stableIdProviders = new Set(['box', 'dropbox', 'drive', 'facebook', 'unsplash'])\n  return stableIdProviders.has(file.remote.provider)\n}\n\nexport function getSafeFileId (file) {\n  if (hasFileStableId(file)) return file.id\n\n  const fileType = getFileType(file)\n\n  return generateFileID({\n    ...file,\n    type: fileType,\n  })\n}\n"],"mappings":"AAAA,OAAOA,WAAP,MAAwB,kBAAxB;;AAEA,SAASC,eAAT,CAA0BC,SAA1B,EAAqC;EACnC,OAAOA,SAAS,CAACC,UAAV,CAAqB,CAArB,EAAwBC,QAAxB,CAAiC,EAAjC,CAAP;AACD;;AAED,SAASC,cAAT,CAAyBC,IAAzB,EAA+B;EAC7B,IAAIC,MAAM,GAAG,EAAb;EACA,OAAOD,IAAI,CAACE,OAAL,CAAa,aAAb,EAA6BN,SAAD,IAAe;IAChDK,MAAM,IAAK,IAAGN,eAAe,CAACC,SAAD,CAAY,EAAzC;IACA,OAAO,GAAP;EACD,CAHM,IAGFK,MAHL;AAID;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,eAAe,SAASE,cAAT,CAAyBC,IAAzB,EAA+B;EAC5C;EACA;EAEA,IAAIC,EAAE,GAAG,MAAT;;EACA,IAAI,OAAOD,IAAI,CAACJ,IAAZ,KAAqB,QAAzB,EAAmC;IACjCK,EAAE,IAAK,IAAGN,cAAc,CAACK,IAAI,CAACJ,IAAL,CAAUM,WAAV,EAAD,CAA0B,EAAlD;EACD;;EAED,IAAIF,IAAI,CAACG,IAAL,KAAcC,SAAlB,EAA6B;IAC3BH,EAAE,IAAK,IAAGD,IAAI,CAACG,IAAK,EAApB;EACD;;EAED,IAAIH,IAAI,CAACK,IAAL,IAAa,OAAOL,IAAI,CAACK,IAAL,CAAUC,YAAjB,KAAkC,QAAnD,EAA6D;IAC3DL,EAAE,IAAK,IAAGN,cAAc,CAACK,IAAI,CAACK,IAAL,CAAUC,YAAV,CAAuBJ,WAAvB,EAAD,CAAuC,EAA/D;EACD;;EAED,IAAIF,IAAI,CAACO,IAAL,CAAUC,IAAV,KAAmBJ,SAAvB,EAAkC;IAChCH,EAAE,IAAK,IAAGD,IAAI,CAACO,IAAL,CAAUC,IAAK,EAAzB;EACD;;EACD,IAAIR,IAAI,CAACO,IAAL,CAAUE,YAAV,KAA2BL,SAA/B,EAA0C;IACxCH,EAAE,IAAK,IAAGD,IAAI,CAACO,IAAL,CAAUE,YAAa,EAAjC;EACD;;EAED,OAAOR,EAAP;AACD,C,CAED;AACA;;AACA,SAASS,eAAT,CAA0BV,IAA1B,EAAgC;EAC9B,IAAI,CAACA,IAAI,CAACW,QAAN,IAAkB,CAACX,IAAI,CAACY,MAA5B,EAAoC,OAAO,KAAP,CADN,CAE9B;;EACA,MAAMC,iBAAiB,GAAG,IAAIC,GAAJ,CAAQ,CAAC,KAAD,EAAQ,SAAR,EAAmB,OAAnB,EAA4B,UAA5B,EAAwC,UAAxC,CAAR,CAA1B;EACA,OAAOD,iBAAiB,CAACE,GAAlB,CAAsBf,IAAI,CAACY,MAAL,CAAYI,QAAlC,CAAP;AACD;;AAED,OAAO,SAASC,aAAT,CAAwBjB,IAAxB,EAA8B;EACnC,IAAIU,eAAe,CAACV,IAAD,CAAnB,EAA2B,OAAOA,IAAI,CAACC,EAAZ;EAE3B,MAAMiB,QAAQ,GAAG5B,WAAW,CAACU,IAAD,CAA5B;EAEA,OAAOD,cAAc,CAAC,EACpB,GAAGC,IADiB;IAEpBG,IAAI,EAAEe;EAFc,CAAD,CAArB;AAID"}