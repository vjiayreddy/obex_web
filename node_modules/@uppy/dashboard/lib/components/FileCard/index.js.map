{"version":3,"names":["h","useEffect","useState","useCallback","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","RenderMetaFields","FileCard","props","uppy","files","fileCardFor","toggleFileCard","saveFileCard","metaFields","requiredMetaFields","openFileEditor","i18n","i18nArray","className","canEditFile","getMetaFields","file","computedMetaFields","showEditButton","storedMetaData","forEach","field","id","meta","formState","setFormState","handleSave","ev","preventDefault","updateMeta","newVal","name","handleCancel","emit","form","formEl","document","createElement","setAttribute","body","appendChild","addEventListener","removeEventListener","removeChild","backgroundColor","type","color","event"],"sources":["index.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { useEffect, useState, useCallback } from 'preact/hooks'\nimport classNames from 'classnames'\nimport { nanoid } from 'nanoid/non-secure'\nimport getFileTypeIcon from '../../utils/getFileTypeIcon.jsx'\nimport ignoreEvent from '../../utils/ignoreEvent.js'\nimport FilePreview from '../FilePreview.jsx'\nimport RenderMetaFields from './RenderMetaFields.jsx'\n\nexport default function FileCard (props) {\n  const {\n    uppy,\n    files,\n    fileCardFor,\n    toggleFileCard,\n    saveFileCard,\n    metaFields,\n    requiredMetaFields,\n    openFileEditor,\n    i18n,\n    i18nArray,\n    className,\n    canEditFile,\n  } = props\n\n  const getMetaFields = () => {\n    return typeof metaFields === 'function'\n      ? metaFields(files[fileCardFor])\n      : metaFields\n  }\n\n  const file = files[fileCardFor]\n  const computedMetaFields = getMetaFields() ?? []\n  const showEditButton = canEditFile(file)\n\n  const storedMetaData = {}\n  computedMetaFields.forEach((field) => {\n    storedMetaData[field.id] = file.meta[field.id] ?? ''\n  })\n\n  const [formState, setFormState] = useState(storedMetaData)\n\n  const handleSave = useCallback((ev) => {\n    ev.preventDefault()\n    saveFileCard(formState, fileCardFor)\n  }, [saveFileCard, formState, fileCardFor])\n\n  const updateMeta = (newVal, name) => {\n    setFormState({ [name]: newVal })\n  }\n\n  const handleCancel = () => {\n    uppy.emit('file-editor:cancel', file)\n    toggleFileCard(false)\n  }\n\n  const [form] = useState(() => {\n    const formEl = document.createElement('form')\n    formEl.setAttribute('tabindex', '-1')\n    formEl.id = nanoid()\n    return formEl\n  })\n\n  useEffect(() => {\n    document.body.appendChild(form)\n    form.addEventListener('submit', handleSave)\n    return () => {\n      form.removeEventListener('submit', handleSave)\n      document.body.removeChild(form)\n    }\n  }, [form, handleSave])\n\n  return (\n    <div\n      className={classNames('uppy-Dashboard-FileCard', className)}\n      data-uppy-panelType=\"FileCard\"\n      onDragOver={ignoreEvent}\n      onDragLeave={ignoreEvent}\n      onDrop={ignoreEvent}\n      onPaste={ignoreEvent}\n    >\n      <div className=\"uppy-DashboardContent-bar\">\n        <div className=\"uppy-DashboardContent-title\" role=\"heading\" aria-level=\"1\">\n          {i18nArray('editing', {\n            file: <span className=\"uppy-DashboardContent-titleFile\">{file.meta ? file.meta.name : file.name}</span>,\n          })}\n        </div>\n        <button\n          className=\"uppy-DashboardContent-back\"\n          type=\"button\"\n          form={form.id}\n          title={i18n('finishEditingFile')}\n          onClick={handleCancel}\n        >\n          {i18n('cancel')}\n        </button>\n      </div>\n\n      <div className=\"uppy-Dashboard-FileCard-inner\">\n        <div className=\"uppy-Dashboard-FileCard-preview\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\n          <FilePreview file={file} />\n          {showEditButton\n            && (\n            <button\n              type=\"button\"\n              className=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\n              onClick={(event) => {\n                // When opening the image editor we want to save any meta fields changes.\n                // Otherwise it's confusing for the user to click save in the editor,\n                // but the changes here are discarded. This bypasses validation,\n                // but we are okay with that.\n                handleSave(event)\n                openFileEditor(file)\n              }}\n            >\n              {i18n('editFile')}\n            </button>\n            )}\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-info\">\n          <RenderMetaFields\n            computedMetaFields={computedMetaFields}\n            requiredMetaFields={requiredMetaFields}\n            updateMeta={updateMeta}\n            form={form}\n            formState={formState}\n          />\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-actions\">\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\n            // If `form` attribute is supported, we want a submit button to trigger the form validation.\n            // Otherwise, fallback to a classic button with a onClick event handler.\n            type=\"submit\"\n            form={form.id}\n          >\n            {i18n('saveChanges')}\n          </button>\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\n            type=\"button\"\n            onClick={handleCancel}\n            form={form.id}\n          >\n            {i18n('cancel')}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}