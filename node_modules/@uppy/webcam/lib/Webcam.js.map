{"version":3,"names":["h","UIPlugin","getFileTypeExtension","mimeTypes","isMobile","canvasToBlob","supportsMediaRecorder","CameraIcon","CameraScreen","PermissionsScreen","packageJson","locale","toMimeType","fileType","slice","isVideoMimeType","mimeType","test","isImageMimeType","getMediaDevices","navigator","mediaDevices","isModeAvailable","modes","mode","includes","Webcam","constructor","uppy","opts","supportsUserMedia","protocol","location","match","id","type","capturedMediaFile","icon","defaultLocale","defaultOptions","onBeforeSnapshot","Promise","resolve","countdown","mirror","showVideoSourceDropdown","facingMode","videoConstraints","undefined","preferredImageMimeType","preferredVideoMimeType","showRecordingLength","mobileNativeCamera","tablet","i18nInit","title","i18n","install","bind","setPluginState","render","start","stop","takeSnapshot","startRecording","stopRecording","discardRecordedVideo","submit","oneTwoThreeSmile","focus","changeVideoSource","webcamActive","hasCamera","cameraReady","cameraError","recordingLengthSeconds","videoSources","currentDeviceId","setOptions","newOpts","hasCameraCheck","enumerateDevices","then","devices","some","device","kind","isAudioOnly","length","getConstraints","deviceId","acceptsAudio","indexOf","acceptsVideo","audio","video","options","reject","Error","constraints","getUserMedia","stream","tracks","getAudioTracks","getVideoTracks","getSettings","forEach","track","updateVideoSources","catch","err","info","message","getMediaRecorderOptions","MediaRecorder","isTypeSupported","restrictions","preferredVideoMimeTypes","allowedFileTypes","map","filter","filterSupportedTypes","candidateType","acceptableMimeTypes","recorder","recordingChunks","stoppingBecauseOfMaxSize","addEventListener","event","push","data","maxFileSize","totalSize","reduce","acc","chunk","size","averageChunkSize","expectedEndChunkSize","maxSize","Math","max","recordingLengthTimer","setInterval","currentRecordingLength","getPluginState","isRecording","stopped","clearInterval","getVideo","file","recordedVideo","URL","createObjectURL","isRestriction","log","error","addFile","audioTracks","videoTracks","concat","once","getVideoElement","el","querySelector","count","countDown","captureInProgress","setTimeout","getImage","tagFile","width","videoWidth","height","videoHeight","canvas","document","createElement","ctx","getContext","drawImage","preferredImageMimeTypes","ext","name","Date","now","blob","source","Blob","find","fileExtension","webcamState","target","getTargetPlugin","showNativeVideoCameraButton","showNativePhotoCameraButton","nativeCameraFacingMode","mount","ondevicechange","restartStream","videoSource","uninstall","unmount","onUnmount","VERSION","version"],"sources":["Webcam.jsx"],"sourcesContent":["import { h } from 'preact'\n\nimport { UIPlugin } from '@uppy/core'\nimport getFileTypeExtension from '@uppy/utils/lib/getFileTypeExtension'\nimport mimeTypes from '@uppy/utils/lib/mimeTypes'\nimport isMobile from 'is-mobile'\nimport canvasToBlob from '@uppy/utils/lib/canvasToBlob'\nimport supportsMediaRecorder from './supportsMediaRecorder.js'\nimport CameraIcon from './CameraIcon.jsx'\nimport CameraScreen from './CameraScreen.jsx'\nimport PermissionsScreen from './PermissionsScreen.jsx'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n/**\n * Normalize a MIME type or file extension into a MIME type.\n *\n * @param {string} fileType - MIME type or a file extension prefixed with `.`.\n * @returns {string|undefined} The MIME type or `undefined` if the fileType is an extension and is not known.\n */\nfunction toMimeType (fileType) {\n  if (fileType[0] === '.') {\n    return mimeTypes[fileType.slice(1)]\n  }\n  return fileType\n}\n\n/**\n * Is this MIME type a video?\n *\n * @param {string} mimeType - MIME type.\n * @returns {boolean}\n */\nfunction isVideoMimeType (mimeType) {\n  return /^video\\/[^*]+$/.test(mimeType)\n}\n\n/**\n * Is this MIME type an image?\n *\n * @param {string} mimeType - MIME type.\n * @returns {boolean}\n */\nfunction isImageMimeType (mimeType) {\n  return /^image\\/[^*]+$/.test(mimeType)\n}\n\nfunction getMediaDevices () {\n  // bug in the compatibility data\n  // eslint-disable-next-line compat/compat\n  return navigator.mediaDevices\n}\n\nfunction isModeAvailable (modes, mode) {\n  return modes.includes(mode)\n}\n\n/**\n * Webcam\n */\nexport default class Webcam extends UIPlugin {\n  static VERSION = packageJson.version\n\n  // enableMirror is used to toggle mirroring, for instance when discarding the video,\n  // while `opts.mirror` is used to remember the initial user setting\n  #enableMirror\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.mediaDevices = getMediaDevices()\n    this.supportsUserMedia = !!this.mediaDevices\n    // eslint-disable-next-line no-restricted-globals\n    this.protocol = location.protocol.match(/https/i) ? 'https' : 'http'\n    this.id = this.opts.id || 'Webcam'\n    this.type = 'acquirer'\n    this.capturedMediaFile = null\n    this.icon = () => (\n      <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n        <path d=\"M23.5 9.5c1.417 0 2.5 1.083 2.5 2.5v9.167c0 1.416-1.083 2.5-2.5 2.5h-15c-1.417 0-2.5-1.084-2.5-2.5V12c0-1.417 1.083-2.5 2.5-2.5h2.917l1.416-2.167C13 7.167 13.25 7 13.5 7h5c.25 0 .5.167.667.333L20.583 9.5H23.5zM16 11.417a4.706 4.706 0 00-4.75 4.75 4.704 4.704 0 004.75 4.75 4.703 4.703 0 004.75-4.75c0-2.663-2.09-4.75-4.75-4.75zm0 7.825c-1.744 0-3.076-1.332-3.076-3.074 0-1.745 1.333-3.077 3.076-3.077 1.744 0 3.074 1.333 3.074 3.076s-1.33 3.075-3.074 3.075z\" fill=\"#02B383\" fillRule=\"nonzero\" />\n      </svg>\n    )\n\n    this.defaultLocale = locale\n\n    // set default options\n    const defaultOptions = {\n      onBeforeSnapshot: () => Promise.resolve(),\n      countdown: false,\n      modes: [\n        'video-audio',\n        'video-only',\n        'audio-only',\n        'picture',\n      ],\n      mirror: true,\n      showVideoSourceDropdown: false,\n      facingMode: 'user', // @TODO: remove in the next major\n      videoConstraints: undefined,\n      preferredImageMimeType: null,\n      preferredVideoMimeType: null,\n      showRecordingLength: false,\n      mobileNativeCamera: isMobile({ tablet: true }),\n    }\n\n    this.opts = { ...defaultOptions, ...opts }\n    this.i18nInit()\n    this.title = this.i18n('pluginNameCamera')\n\n    this.#enableMirror = this.opts.mirror\n\n    this.install = this.install.bind(this)\n    this.setPluginState = this.setPluginState.bind(this)\n    this.render = this.render.bind(this)\n\n    // Camera controls\n    this.start = this.start.bind(this)\n    this.stop = this.stop.bind(this)\n    this.takeSnapshot = this.takeSnapshot.bind(this)\n    this.startRecording = this.startRecording.bind(this)\n    this.stopRecording = this.stopRecording.bind(this)\n    this.discardRecordedVideo = this.discardRecordedVideo.bind(this)\n    this.submit = this.submit.bind(this)\n    this.oneTwoThreeSmile = this.oneTwoThreeSmile.bind(this)\n    this.focus = this.focus.bind(this)\n    this.changeVideoSource = this.changeVideoSource.bind(this)\n\n    this.webcamActive = false\n\n    if (this.opts.countdown) {\n      this.opts.onBeforeSnapshot = this.oneTwoThreeSmile\n    }\n\n    this.setPluginState({\n      hasCamera: false,\n      cameraReady: false,\n      cameraError: null,\n      recordingLengthSeconds: 0,\n      videoSources: [],\n      currentDeviceId: null,\n    })\n  }\n\n  setOptions (newOpts) {\n    super.setOptions({\n      ...newOpts,\n      videoConstraints: {\n        // May be undefined but ... handles that\n        ...this.opts.videoConstraints,\n        ...newOpts?.videoConstraints,\n      },\n    })\n  }\n\n  hasCameraCheck () {\n    if (!this.mediaDevices) {\n      return Promise.resolve(false)\n    }\n\n    return this.mediaDevices.enumerateDevices().then(devices => {\n      return devices.some(device => device.kind === 'videoinput')\n    })\n  }\n\n  isAudioOnly () {\n    return this.opts.modes.length === 1 && this.opts.modes[0] === 'audio-only'\n  }\n\n  getConstraints (deviceId = null) {\n    const acceptsAudio = this.opts.modes.indexOf('video-audio') !== -1\n      || this.opts.modes.indexOf('audio-only') !== -1\n    const acceptsVideo = !this.isAudioOnly()\n        && (this.opts.modes.indexOf('video-audio') !== -1\n          || this.opts.modes.indexOf('video-only') !== -1\n          || this.opts.modes.indexOf('picture') !== -1)\n\n    const videoConstraints = {\n      ...(this.opts.videoConstraints || { facingMode: this.opts.facingMode }),\n      // facingMode takes precedence over deviceId, and not needed\n      // when specific device is selected\n      ...(deviceId ? { deviceId, facingMode: null } : {}),\n    }\n\n    return {\n      audio: acceptsAudio,\n      video: acceptsVideo ? videoConstraints : false,\n    }\n  }\n\n  // eslint-disable-next-line consistent-return\n  start (options = null) {\n    if (!this.supportsUserMedia) {\n      return Promise.reject(new Error('Webcam access not supported'))\n    }\n\n    this.webcamActive = true\n\n    if (this.opts.mirror) {\n      this.#enableMirror = true\n    }\n\n    const constraints = this.getConstraints(options && options.deviceId ? options.deviceId : null)\n\n    this.hasCameraCheck().then(hasCamera => {\n      this.setPluginState({\n        hasCamera,\n      })\n\n      // ask user for access to their camera\n      return this.mediaDevices.getUserMedia(constraints)\n        .then((stream) => {\n          this.stream = stream\n\n          let currentDeviceId = null\n          const tracks = this.isAudioOnly() ? stream.getAudioTracks() : stream.getVideoTracks()\n\n          if (!options || !options.deviceId) {\n            currentDeviceId = tracks[0].getSettings().deviceId\n          } else {\n            tracks.forEach((track) => {\n              if (track.getSettings().deviceId === options.deviceId) {\n                currentDeviceId = track.getSettings().deviceId\n              }\n            })\n          }\n\n          // Update the sources now, so we can access the names.\n          this.updateVideoSources()\n\n          this.setPluginState({\n            currentDeviceId,\n            cameraReady: true,\n          })\n        })\n        .catch((err) => {\n          this.setPluginState({\n            cameraReady: false,\n            cameraError: err,\n          })\n          this.uppy.info(err.message, 'error')\n        })\n    })\n  }\n\n  /**\n   * @returns {object}\n   */\n  getMediaRecorderOptions () {\n    const options = {}\n\n    // Try to use the `opts.preferredVideoMimeType` or one of the `allowedFileTypes` for the recording.\n    // If the browser doesn't support it, we'll fall back to the browser default instead.\n    // Safari doesn't have the `isTypeSupported` API.\n    if (MediaRecorder.isTypeSupported) {\n      const { restrictions } = this.uppy.opts\n      let preferredVideoMimeTypes = []\n      if (this.opts.preferredVideoMimeType) {\n        preferredVideoMimeTypes = [this.opts.preferredVideoMimeType]\n      } else if (restrictions.allowedFileTypes) {\n        preferredVideoMimeTypes = restrictions.allowedFileTypes.map(toMimeType).filter(isVideoMimeType)\n      }\n\n      const filterSupportedTypes = (candidateType) => MediaRecorder.isTypeSupported(candidateType)\n        && getFileTypeExtension(candidateType)\n      const acceptableMimeTypes = preferredVideoMimeTypes.filter(filterSupportedTypes)\n\n      if (acceptableMimeTypes.length > 0) {\n        // eslint-disable-next-line prefer-destructuring\n        options.mimeType = acceptableMimeTypes[0]\n      }\n    }\n\n    return options\n  }\n\n  startRecording () {\n    // only used if supportsMediaRecorder() returned true\n    // eslint-disable-next-line compat/compat\n    this.recorder = new MediaRecorder(this.stream, this.getMediaRecorderOptions())\n    this.recordingChunks = []\n    let stoppingBecauseOfMaxSize = false\n    this.recorder.addEventListener('dataavailable', (event) => {\n      this.recordingChunks.push(event.data)\n\n      const { restrictions } = this.uppy.opts\n      if (this.recordingChunks.length > 1\n          && restrictions.maxFileSize != null\n          && !stoppingBecauseOfMaxSize) {\n        const totalSize = this.recordingChunks.reduce((acc, chunk) => acc + chunk.size, 0)\n        // Exclude the initial chunk from the average size calculation because it is likely to be a very small outlier\n        const averageChunkSize = (totalSize - this.recordingChunks[0].size) / (this.recordingChunks.length - 1)\n        const expectedEndChunkSize = averageChunkSize * 3\n        const maxSize = Math.max(0, restrictions.maxFileSize - expectedEndChunkSize)\n\n        if (totalSize > maxSize) {\n          stoppingBecauseOfMaxSize = true\n          this.uppy.info(this.i18n('recordingStoppedMaxSize'), 'warning', 4000)\n          this.stopRecording()\n        }\n      }\n    })\n\n    // use a \"time slice\" of 500ms: ondataavailable will be called each 500ms\n    // smaller time slices mean we can more accurately check the max file size restriction\n    this.recorder.start(500)\n\n    if (this.opts.showRecordingLength) {\n      // Start the recordingLengthTimer if we are showing the recording length.\n      this.recordingLengthTimer = setInterval(() => {\n        const currentRecordingLength = this.getPluginState().recordingLengthSeconds\n        this.setPluginState({ recordingLengthSeconds: currentRecordingLength + 1 })\n      }, 1000)\n    }\n\n    this.setPluginState({\n      isRecording: true,\n    })\n  }\n\n  stopRecording () {\n    const stopped = new Promise((resolve) => {\n      this.recorder.addEventListener('stop', () => {\n        resolve()\n      })\n      this.recorder.stop()\n\n      if (this.opts.showRecordingLength) {\n        // Stop the recordingLengthTimer if we are showing the recording length.\n        clearInterval(this.recordingLengthTimer)\n        this.setPluginState({ recordingLengthSeconds: 0 })\n      }\n    })\n\n    return stopped.then(() => {\n      this.setPluginState({\n        isRecording: false,\n      })\n      return this.getVideo()\n    }).then((file) => {\n      try {\n        this.capturedMediaFile = file\n        // create object url for capture result preview\n        this.setPluginState({\n          // eslint-disable-next-line compat/compat\n          recordedVideo: URL.createObjectURL(file.data),\n        })\n        this.#enableMirror = false\n      } catch (err) {\n        // Logging the error, exept restrictions, which is handled in Core\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n      }\n    }).then(() => {\n      this.recordingChunks = null\n      this.recorder = null\n    }, (error) => {\n      this.recordingChunks = null\n      this.recorder = null\n      throw error\n    })\n  }\n\n  discardRecordedVideo () {\n    this.setPluginState({ recordedVideo: null })\n\n    if (this.opts.mirror) {\n      this.#enableMirror = true\n    }\n\n    this.capturedMediaFile = null\n  }\n\n  submit () {\n    try {\n      if (this.capturedMediaFile) {\n        this.uppy.addFile(this.capturedMediaFile)\n      }\n    } catch (err) {\n      // Logging the error, exept restrictions, which is handled in Core\n      if (!err.isRestriction) {\n        this.uppy.log(err, 'error')\n      }\n    }\n  }\n\n  async stop () {\n    if (this.stream) {\n      const audioTracks = this.stream.getAudioTracks()\n      const videoTracks = this.stream.getVideoTracks()\n\n      audioTracks.concat(videoTracks).forEach((track) => track.stop())\n    }\n\n    if (this.recorder) {\n      await new Promise((resolve) => {\n        this.recorder.addEventListener('stop', resolve, { once: true })\n        this.recorder.stop()\n\n        if (this.opts.showRecordingLength) {\n          clearInterval(this.recordingLengthTimer)\n        }\n      })\n    }\n\n    this.recordingChunks = null\n    this.recorder = null\n    this.webcamActive = false\n    this.stream = null\n\n    this.setPluginState({\n      recordedVideo: null,\n      isRecording: false,\n      recordingLengthSeconds: 0,\n    })\n  }\n\n  getVideoElement () {\n    return this.el.querySelector('.uppy-Webcam-video')\n  }\n\n  oneTwoThreeSmile () {\n    return new Promise((resolve, reject) => {\n      let count = this.opts.countdown\n\n      // eslint-disable-next-line consistent-return\n      const countDown = setInterval(() => {\n        if (!this.webcamActive) {\n          clearInterval(countDown)\n          this.captureInProgress = false\n          return reject(new Error('Webcam is not active'))\n        }\n\n        if (count > 0) {\n          this.uppy.info(`${count}...`, 'warning', 800)\n          count--\n        } else {\n          clearInterval(countDown)\n          this.uppy.info(this.i18n('smile'), 'success', 1500)\n          setTimeout(() => resolve(), 1500)\n        }\n      }, 1000)\n    })\n  }\n\n  takeSnapshot () {\n    if (this.captureInProgress) return\n\n    this.captureInProgress = true\n\n    this.opts.onBeforeSnapshot().catch((err) => {\n      const message = typeof err === 'object' ? err.message : err\n      this.uppy.info(message, 'error', 5000)\n      return Promise.reject(new Error(`onBeforeSnapshot: ${message}`))\n    }).then(() => {\n      return this.getImage()\n    }).then((tagFile) => {\n      this.captureInProgress = false\n      try {\n        this.uppy.addFile(tagFile)\n      } catch (err) {\n        // Logging the error, except restrictions, which is handled in Core\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n      }\n    }, (error) => {\n      this.captureInProgress = false\n      throw error\n    })\n  }\n\n  getImage () {\n    const video = this.getVideoElement()\n    if (!video) {\n      return Promise.reject(new Error('No video element found, likely due to the Webcam tab being closed.'))\n    }\n\n    const width = video.videoWidth\n    const height = video.videoHeight\n\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')\n    ctx.drawImage(video, 0, 0)\n\n    const { restrictions } = this.uppy.opts\n    let preferredImageMimeTypes = []\n    if (this.opts.preferredImageMimeType) {\n      preferredImageMimeTypes = [this.opts.preferredImageMimeType]\n    } else if (restrictions.allowedFileTypes) {\n      preferredImageMimeTypes = restrictions.allowedFileTypes.map(toMimeType).filter(isImageMimeType)\n    }\n\n    const mimeType = preferredImageMimeTypes[0] || 'image/jpeg'\n    const ext = getFileTypeExtension(mimeType) || 'jpg'\n    const name = `cam-${Date.now()}.${ext}`\n\n    return canvasToBlob(canvas, mimeType).then((blob) => {\n      return {\n        source: this.id,\n        name,\n        data: new Blob([blob], { type: mimeType }),\n        type: mimeType,\n      }\n    })\n  }\n\n  getVideo () {\n    // Sometimes in iOS Safari, Blobs (especially the first Blob in the recordingChunks Array)\n    // have empty 'type' attributes (e.g. '') so we need to find a Blob that has a defined 'type'\n    // attribute in order to determine the correct MIME type.\n    const mimeType = this.recordingChunks.find(blob => blob.type?.length > 0).type\n\n    const fileExtension = getFileTypeExtension(mimeType)\n\n    if (!fileExtension) {\n      return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type \"${mimeType}\"`))\n    }\n\n    const name = `webcam-${Date.now()}.${fileExtension}`\n    const blob = new Blob(this.recordingChunks, { type: mimeType })\n    const file = {\n      source: this.id,\n      name,\n      data: new Blob([blob], { type: mimeType }),\n      type: mimeType,\n    }\n\n    return Promise.resolve(file)\n  }\n\n  focus () {\n    if (!this.opts.countdown) return\n    setTimeout(() => {\n      this.uppy.info(this.i18n('smile'), 'success', 1500)\n    }, 1000)\n  }\n\n  changeVideoSource (deviceId) {\n    this.stop()\n    this.start({ deviceId })\n  }\n\n  updateVideoSources () {\n    this.mediaDevices.enumerateDevices().then(devices => {\n      this.setPluginState({\n        videoSources: devices.filter((device) => device.kind === 'videoinput'),\n      })\n    })\n  }\n\n  render () {\n    if (!this.webcamActive) {\n      this.start()\n    }\n\n    const webcamState = this.getPluginState()\n\n    if (!webcamState.cameraReady || !webcamState.hasCamera) {\n      return (\n        <PermissionsScreen\n          icon={CameraIcon}\n          i18n={this.i18n}\n          hasCamera={webcamState.hasCamera}\n        />\n      )\n    }\n\n    return (\n      <CameraScreen\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...webcamState}\n        onChangeVideoSource={this.changeVideoSource}\n        onSnapshot={this.takeSnapshot}\n        onStartRecording={this.startRecording}\n        onStopRecording={this.stopRecording}\n        onDiscardRecordedVideo={this.discardRecordedVideo}\n        onSubmit={this.submit}\n        onFocus={this.focus}\n        onStop={this.stop}\n        i18n={this.i18n}\n        modes={this.opts.modes}\n        showRecordingLength={this.opts.showRecordingLength}\n        showVideoSourceDropdown={this.opts.showVideoSourceDropdown}\n        supportsRecording={supportsMediaRecorder()}\n        recording={webcamState.isRecording}\n        mirror={this.#enableMirror}\n        src={this.stream}\n      />\n    )\n  }\n\n  install () {\n    const { mobileNativeCamera, modes, facingMode, videoConstraints } = this.opts\n\n    const { target } = this.opts\n    if (mobileNativeCamera && target) {\n      this.getTargetPlugin(target)?.setOptions({\n        showNativeVideoCameraButton: isModeAvailable(modes, 'video-only') || isModeAvailable(modes, 'video-audio'),\n        showNativePhotoCameraButton: isModeAvailable(modes, 'picture'),\n        nativeCameraFacingMode: videoConstraints?.facingMode || facingMode,\n      })\n      return\n    }\n\n    this.setPluginState({\n      cameraReady: false,\n      recordingLengthSeconds: 0,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n\n    if (this.mediaDevices) {\n      this.updateVideoSources()\n\n      this.mediaDevices.ondevicechange = () => {\n        this.updateVideoSources()\n\n        if (this.stream) {\n          let restartStream = true\n\n          const { videoSources, currentDeviceId } = this.getPluginState()\n\n          videoSources.forEach((videoSource) => {\n            if (currentDeviceId === videoSource.deviceId) {\n              restartStream = false\n            }\n          })\n\n          if (restartStream) {\n            this.stop()\n            this.start()\n          }\n        }\n      }\n    }\n  }\n\n  uninstall () {\n    this.stop()\n    this.unmount()\n  }\n\n  onUnmount () {\n    this.stop()\n  }\n}\n"],"mappings":"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"}