{"version":3,"names":["h","SearchFilterInput","Browser","CloseWrapper","View","packageJson","SearchProviderView","constructor","plugin","opts","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","search","bind","clearSearch","resetPluginState","handleScroll","donePicking","render","defaultState","isInputMode","files","folders","directories","filterInput","currentSelection","searchTerm","setPluginState","tearDown","query","getPluginState","setLoading","res","provider","err","handleError","event","nextPageQuery","shouldHandleScroll","isHandlingScroll","response","error","uppy","log","addFiles","map","file","getTagFile","state","viewOptions","didFirstRender","i18n","preFirstRender","targetViewOptions","loading","isChecked","toggleCheckbox","filterItems","hasInput","browserProps","done","cancel","cancelPicking","showSearchFilter","searchOnInput","searchInputLabel","clearSearchLabel","noResultsLabel","title","isLoading","pluginIcon","icon","uppyFiles","getFiles","validateRestrictions","clearSelection","items","forEach","item","push","searchedFor","VERSION","version"],"sources":["SearchProviderView.jsx"],"sourcesContent":["import { h } from 'preact'\n\nimport SearchFilterInput from '../SearchFilterInput.jsx'\nimport Browser from '../Browser.jsx'\nimport CloseWrapper from '../CloseWrapper.js'\nimport View from '../View.js'\n\nimport packageJson from '../../package.json'\n\n/**\n * SearchProviderView, used for Unsplash and future image search providers.\n * Extends generic View, shared with regular providers like Google Drive and Instagram.\n */\nexport default class SearchProviderView extends View {\n  static VERSION = packageJson.version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.search = this.search.bind(this)\n    this.clearSearch = this.clearSearch.bind(this)\n    this.resetPluginState = this.resetPluginState.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.defaultState = {\n      isInputMode: true,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      currentSelection: [],\n      searchTerm: null,\n    }\n\n    // Set default state for the plugin\n    this.plugin.setPluginState(this.defaultState)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown () {\n    // Nothing.\n  }\n\n  resetPluginState () {\n    this.plugin.setPluginState(this.defaultState)\n  }\n\n  #updateFilesAndInputMode (res, files) {\n    this.nextPageQuery = res.nextPageQuery\n    res.items.forEach((item) => { files.push(item) })\n    this.plugin.setPluginState({\n      currentSelection: [],\n      isInputMode: false,\n      files,\n      searchTerm: res.searchedFor,\n    })\n  }\n\n  async search (query) {\n    const { searchTerm } = this.plugin.getPluginState()\n    if (query && query === searchTerm) {\n      // no need to search again as this is the same as the previous search\n      return\n    }\n\n    this.setLoading(true)\n    try {\n      const res = await this.provider.search(query)\n      this.#updateFilesAndInputMode(res, [])\n    } catch (err) {\n      this.handleError(err)\n    } finally {\n      this.setLoading(false)\n    }\n  }\n\n  clearSearch () {\n    this.plugin.setPluginState({\n      currentSelection: [],\n      files: [],\n      searchTerm: null,\n    })\n  }\n\n  async handleScroll (event) {\n    const query = this.nextPageQuery || null\n\n    if (this.shouldHandleScroll(event) && query) {\n      this.isHandlingScroll = true\n\n      try {\n        const { files, searchTerm } = this.plugin.getPluginState()\n        const response = await this.provider.search(searchTerm, query)\n\n        this.#updateFilesAndInputMode(response, files)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    this.plugin.uppy.log('Adding remote search provider files')\n    this.plugin.uppy.addFiles(currentSelection.map((file) => this.getTagFile(file)))\n    this.resetPluginState()\n  }\n\n  render (state, viewOptions = {}) {\n    const { didFirstRender, isInputMode, searchTerm } = this.plugin.getPluginState()\n    const { i18n } = this.plugin.uppy\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, filterItems } = this\n    const hasInput = filterInput !== ''\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n\n      // For SearchFilterInput component\n      showSearchFilter: targetViewOptions.showFilter,\n      search: this.search,\n      clearSearch: this.clearSearch,\n      searchTerm,\n      searchOnInput: false,\n      searchInputLabel: i18n('search'),\n      clearSearchLabel: i18n('resetSearch'),\n\n      noResultsLabel: i18n('noSearchResults'),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      isLoading: loading,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (isInputMode) {\n      return (\n        <CloseWrapper onUnmount={this.resetPluginState}>\n          <div className=\"uppy-SearchProvider\">\n            <SearchFilterInput\n              search={this.search}\n              clearSelection={this.clearSelection}\n              inputLabel={i18n('enterTextToSearch')}\n              buttonLabel={i18n('searchImages')}\n              inputClassName=\"uppy-c-textInput uppy-SearchProvider-input\"\n              buttonCSSClassName=\"uppy-SearchProvider-searchButton\"\n              showButton\n            />\n          </div>\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.resetPluginState}>\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"],"mappings":"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"}