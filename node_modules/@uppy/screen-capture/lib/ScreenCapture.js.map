{"version":3,"names":["h","UIPlugin","getFileTypeExtension","ScreenRecIcon","RecorderScreen","packageJson","locale","isScreenRecordingSupported","window","MediaRecorder","navigator","mediaDevices","getDisplayMedia","getMediaDevices","ScreenCapture","constructor","uppy","opts","protocol","location","id","title","type","icon","defaultLocale","defaultOptions","displayMediaConstraints","video","width","height","frameRate","ideal","max","cursor","displaySurface","userMediaConstraints","audio","preferredVideoMimeType","i18nInit","install","bind","setPluginState","render","start","stop","startRecording","stopRecording","submit","streamInterrupted","streamInactivated","captureActive","capturedMediaFile","log","streamActive","audioStreamActive","target","mount","undefined","uninstall","videoStream","unmount","Promise","reject","Error","selectAudioStreamSource","selectVideoStreamSource","then","res","parent","hideAllPanels","resolve","addEventListener","catch","err","screenRecError","userDenied","setTimeout","audioStream","getUserMedia","name","info","i18n","options","recordingChunks","isTypeSupported","mimeType","tracks","getVideoTracks","push","getAudioTracks","outputStream","MediaStream","recorder","event","data","recording","recordedVideo","getPluginState","stopped","getVideo","file","URL","createObjectURL","error","addFile","isRestriction","forEach","track","fileExtension","Date","now","blob","Blob","source","recorderState","VERSION","version"],"sources":["ScreenCapture.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport getFileTypeExtension from '@uppy/utils/lib/getFileTypeExtension'\nimport ScreenRecIcon from './ScreenRecIcon.jsx'\nimport RecorderScreen from './RecorderScreen.jsx'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n// Check if screen capturing is supported.\n// mediaDevices is supprted on mobile Safari, getDisplayMedia is not\nfunction isScreenRecordingSupported () {\n  return window.MediaRecorder && navigator.mediaDevices?.getDisplayMedia // eslint-disable-line compat/compat\n}\n\n// Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\nfunction getMediaDevices () {\n  return window.MediaRecorder && navigator.mediaDevices // eslint-disable-line compat/compat\n}\n\n/**\n * Screen capture\n */\nexport default class ScreenCapture extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.mediaDevices = getMediaDevices()\n    // eslint-disable-next-line no-restricted-globals\n    this.protocol = location.protocol === 'https:' ? 'https' : 'http'\n    this.id = this.opts.id || 'ScreenCapture'\n    this.title = this.opts.title || 'Screencast'\n    this.type = 'acquirer'\n    this.icon = ScreenRecIcon\n\n    this.defaultLocale = locale\n\n    // set default options\n    // https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints\n    const defaultOptions = {\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#Properties_of_shared_screen_tracks\n      displayMediaConstraints: {\n        video: {\n          width: 1280,\n          height: 720,\n          frameRate: {\n            ideal: 3,\n            max: 5,\n          },\n          cursor: 'motion',\n          displaySurface: 'monitor',\n        },\n      },\n      // https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints/audio\n      userMediaConstraints: {\n        audio: true,\n      },\n      preferredVideoMimeType: 'video/webm',\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // i18n\n    this.i18nInit()\n\n    // uppy plugin class related\n    this.install = this.install.bind(this)\n    this.setPluginState = this.setPluginState.bind(this)\n    this.render = this.render.bind(this)\n\n    // screen capturer related\n    this.start = this.start.bind(this)\n    this.stop = this.stop.bind(this)\n    this.startRecording = this.startRecording.bind(this)\n    this.stopRecording = this.stopRecording.bind(this)\n    this.submit = this.submit.bind(this)\n    this.streamInterrupted = this.streamInactivated.bind(this)\n\n    // initialize\n    this.captureActive = false\n    this.capturedMediaFile = null\n  }\n\n  install () {\n    if (!isScreenRecordingSupported()) {\n      this.uppy.log('Screen recorder access is not supported', 'warning')\n      return null\n    }\n\n    this.setPluginState({\n      streamActive: false,\n      audioStreamActive: false,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n\n    return undefined\n  }\n\n  uninstall () {\n    if (this.videoStream) {\n      this.stop()\n    }\n\n    this.unmount()\n  }\n\n  start () {\n    if (!this.mediaDevices) {\n      return Promise.reject(new Error('Screen recorder access not supported'))\n    }\n\n    this.captureActive = true\n\n    this.selectAudioStreamSource()\n\n    return this.selectVideoStreamSource()\n      .then(res => {\n        // something happened in start -> return\n        if (res === false) {\n          // Close the Dashboard panel if plugin is installed\n          // into Dashboard (could be other parent UI plugin)\n          if (this.parent && this.parent.hideAllPanels) {\n            this.parent.hideAllPanels()\n            this.captureActive = false\n          }\n        }\n      })\n  }\n\n  selectVideoStreamSource () {\n    // if active stream available, return it\n    if (this.videoStream) {\n      return new Promise(resolve => resolve(this.videoStream))\n    }\n\n    // ask user to select source to record and get mediastream from that\n    // eslint-disable-next-line compat/compat\n    return this.mediaDevices.getDisplayMedia(this.opts.displayMediaConstraints)\n      .then((videoStream) => {\n        this.videoStream = videoStream\n\n        // add event listener to stop recording if stream is interrupted\n        this.videoStream.addEventListener('inactive', () => {\n          this.streamInactivated()\n        })\n\n        this.setPluginState({\n          streamActive: true,\n        })\n\n        return videoStream\n      })\n      .catch((err) => {\n        this.setPluginState({\n          screenRecError: err,\n        })\n\n        this.userDenied = true\n\n        setTimeout(() => {\n          this.userDenied = false\n        }, 1000)\n\n        return false\n      })\n  }\n\n  selectAudioStreamSource () {\n    // if active stream available, return it\n    if (this.audioStream) {\n      return new Promise(resolve => resolve(this.audioStream))\n    }\n\n    // ask user to select source to record and get mediastream from that\n    // eslint-disable-next-line compat/compat\n    return this.mediaDevices.getUserMedia(this.opts.userMediaConstraints)\n      .then((audioStream) => {\n        this.audioStream = audioStream\n\n        this.setPluginState({\n          audioStreamActive: true,\n        })\n\n        return audioStream\n      })\n      .catch((err) => {\n        if (err.name === 'NotAllowedError') {\n          this.uppy.info(this.i18n('micDisabled'), 'error', 5000)\n          this.uppy.log(this.i18n('micDisabled'), 'warning')\n        }\n        return false\n      })\n  }\n\n  startRecording () {\n    const options = {}\n    this.capturedMediaFile = null\n    this.recordingChunks = []\n    const { preferredVideoMimeType } = this.opts\n\n    this.selectVideoStreamSource()\n      .then((videoStream) => {\n        // Attempt to use the passed preferredVideoMimeType (if any) during recording.\n        // If the browser doesn't support it, we'll fall back to the browser default instead\n        if (preferredVideoMimeType\n            && MediaRecorder.isTypeSupported(preferredVideoMimeType)\n            && getFileTypeExtension(preferredVideoMimeType)) {\n          options.mimeType = preferredVideoMimeType\n        }\n\n        // prepare tracks\n        const tracks = [videoStream.getVideoTracks()[0]]\n\n        // merge audio if exits\n        if (this.audioStream) {\n          tracks.push(this.audioStream.getAudioTracks()[0])\n        }\n\n        // create new stream from video and audio\n        // eslint-disable-next-line compat/compat\n        this.outputStream = new MediaStream(tracks)\n\n        // initialize mediarecorder\n        // eslint-disable-next-line compat/compat\n        this.recorder = new MediaRecorder(this.outputStream, options)\n\n        // push data to buffer when data available\n        this.recorder.addEventListener('dataavailable', (event) => {\n          this.recordingChunks.push(event.data)\n        })\n\n        // start recording\n        this.recorder.start()\n\n        // set plugin state to recording\n        this.setPluginState({\n          recording: true,\n        })\n      })\n      .catch((err) => {\n        this.uppy.log(err, 'error')\n      })\n  }\n\n  streamInactivated () {\n    // get screen recorder state\n    const { recordedVideo, recording } = { ...this.getPluginState() }\n\n    if (!recordedVideo && !recording) {\n      // Close the Dashboard panel if plugin is installed\n      // into Dashboard (could be other parent UI plugin)\n      if (this.parent && this.parent.hideAllPanels) {\n        this.parent.hideAllPanels()\n      }\n    } else if (recording) {\n      // stop recorder if it is active\n      this.uppy.log('Capture stream inactive â€” stop recording')\n      this.stopRecording()\n    }\n\n    this.videoStream = null\n    this.audioStream = null\n\n    this.setPluginState({\n      streamActive: false, audioStreamActive: false,\n    })\n  }\n\n  stopRecording () {\n    const stopped = new Promise((resolve) => {\n      this.recorder.addEventListener('stop', () => {\n        resolve()\n      })\n\n      this.recorder.stop()\n    })\n\n    return stopped.then(() => {\n      // recording stopped\n      this.setPluginState({\n        recording: false,\n      })\n      // get video file after recorder stopped\n      return this.getVideo()\n    }).then((file) => {\n      // store media file\n      this.capturedMediaFile = file\n\n      // create object url for capture result preview\n      this.setPluginState({\n        // eslint-disable-next-line compat/compat\n        recordedVideo: URL.createObjectURL(file.data),\n      })\n    }).then(() => {\n      this.recordingChunks = null\n      this.recorder = null\n    }, (error) => {\n      this.recordingChunks = null\n      this.recorder = null\n      throw error\n    })\n  }\n\n  submit () {\n    try {\n      // add recorded file to uppy\n      if (this.capturedMediaFile) {\n        this.uppy.addFile(this.capturedMediaFile)\n      }\n    } catch (err) {\n      // Logging the error, exept restrictions, which is handled in Core\n      if (!err.isRestriction) {\n        this.uppy.log(err, 'warning')\n      }\n    }\n  }\n\n  stop () {\n    // flush video stream\n    if (this.videoStream) {\n      this.videoStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.videoStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.videoStream = null\n    }\n\n    // flush audio stream\n    if (this.audioStream) {\n      this.audioStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.audioStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.audioStream = null\n    }\n\n    // flush output stream\n    if (this.outputStream) {\n      this.outputStream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.outputStream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n      this.outputStream = null\n    }\n\n    // remove preview video\n    this.setPluginState({\n      recordedVideo: null,\n    })\n\n    this.captureActive = false\n  }\n\n  getVideo () {\n    const mimeType = this.recordingChunks[0].type\n    const fileExtension = getFileTypeExtension(mimeType)\n\n    if (!fileExtension) {\n      return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type \"${mimeType}\"`))\n    }\n\n    const name = `screencap-${Date.now()}.${fileExtension}`\n    const blob = new Blob(this.recordingChunks, { type: mimeType })\n    const file = {\n      source: this.id,\n      name,\n      data: new Blob([blob], { type: mimeType }),\n      type: mimeType,\n    }\n\n    return Promise.resolve(file)\n  }\n\n  render () {\n    // get screen recorder state\n    const recorderState = this.getPluginState()\n\n    if (!recorderState.streamActive && !this.captureActive && !this.userDenied) {\n      this.start()\n    }\n\n    return (\n      <RecorderScreen\n        {...recorderState} // eslint-disable-line react/jsx-props-no-spreading\n        onStartRecording={this.startRecording}\n        onStopRecording={this.stopRecording}\n        onStop={this.stop}\n        onSubmit={this.submit}\n        i18n={this.i18n}\n        stream={this.videoStream}\n      />\n    )\n  }\n}\n"],"mappings":"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"}