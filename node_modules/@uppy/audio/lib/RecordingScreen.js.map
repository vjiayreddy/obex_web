{"version":3,"names":["h","useEffect","useRef","RecordButton","RecordingLength","AudioSourceSelect","AudioOscilloscope","SubmitButton","DiscardButton","RecordingScreen","props","stream","recordedAudio","onStop","recording","supportsRecording","audioSources","showAudioSourceDropdown","onSubmit","i18n","onStartRecording","onStopRecording","onDiscardRecordedAudio","recordingLengthSeconds","canvasEl","oscilloscope","current","canvas","width","height","canvasContext","lineWidth","fillStyle","strokeStyle","draw","audioContext","AudioContext","source","createMediaStreamSource","addSource","hasRecordedAudio","shouldShowRecordButton","shouldShowAudioSourceDropdown","length"],"sources":["RecordingScreen.jsx"],"sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\nimport { h } from 'preact'\nimport { useEffect, useRef } from 'preact/hooks'\nimport RecordButton from './RecordButton.jsx'\nimport RecordingLength from './RecordingLength.jsx'\nimport AudioSourceSelect from './AudioSourceSelect.jsx'\nimport AudioOscilloscope from './audio-oscilloscope/index.js'\nimport SubmitButton from './SubmitButton.jsx'\nimport DiscardButton from './DiscardButton.jsx'\n\nexport default function RecordingScreen (props) {\n  const {\n    stream,\n    recordedAudio,\n    onStop,\n    recording,\n    supportsRecording,\n    audioSources,\n    showAudioSourceDropdown,\n    onSubmit,\n    i18n,\n    onStartRecording,\n    onStopRecording,\n    onDiscardRecordedAudio,\n    recordingLengthSeconds,\n  } = props\n\n  const canvasEl = useRef(null)\n  const oscilloscope = useRef(null)\n\n  // componentDidMount / componentDidUnmount\n  useEffect(() => {\n    return () => {\n      oscilloscope.current = null\n      onStop()\n    }\n  }, [onStop])\n\n  // componentDidUpdate\n  useEffect(() => {\n    if (!recordedAudio) {\n      oscilloscope.current = new AudioOscilloscope(canvasEl.current, {\n        canvas: {\n          width: 600,\n          height: 600,\n        },\n        canvasContext: {\n          lineWidth: 2,\n          fillStyle: 'rgb(0,0,0)',\n          strokeStyle: 'green',\n        },\n      })\n      oscilloscope.current.draw()\n\n      if (stream) {\n        const audioContext = new AudioContext()\n        const source = audioContext.createMediaStreamSource(stream)\n        oscilloscope.current.addSource(source)\n      }\n    }\n  }, [recordedAudio, stream])\n\n  const hasRecordedAudio = recordedAudio != null\n  const shouldShowRecordButton = !hasRecordedAudio && supportsRecording\n  const shouldShowAudioSourceDropdown = showAudioSourceDropdown\n    && !hasRecordedAudio\n    && audioSources\n    && audioSources.length > 1\n\n  return (\n    <div className=\"uppy-Audio-container\">\n      <div className=\"uppy-Audio-audioContainer\">\n        {hasRecordedAudio\n          ? (\n            <audio\n              className=\"uppy-Audio-player\"\n              controls\n              src={recordedAudio}\n            />\n          ) : (\n            <canvas\n              ref={canvasEl}\n              className=\"uppy-Audio-canvas\"\n            />\n          )}\n      </div>\n      <div className=\"uppy-Audio-footer\">\n        <div className=\"uppy-Audio-audioSourceContainer\">\n          {shouldShowAudioSourceDropdown\n            ? AudioSourceSelect(props)\n            : null}\n        </div>\n        <div className=\"uppy-Audio-buttonContainer\">\n          {shouldShowRecordButton && (\n            <RecordButton\n              recording={recording}\n              onStartRecording={onStartRecording}\n              onStopRecording={onStopRecording}\n              i18n={i18n}\n            />\n          )}\n\n          {hasRecordedAudio && <SubmitButton onSubmit={onSubmit} i18n={i18n} />}\n\n          {hasRecordedAudio && <DiscardButton onDiscard={onDiscardRecordedAudio} i18n={i18n} />}\n        </div>\n\n        <div className=\"uppy-Audio-recordingLength\">\n          {!hasRecordedAudio && (\n            <RecordingLength recordingLengthSeconds={recordingLengthSeconds} i18n={i18n} />\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}