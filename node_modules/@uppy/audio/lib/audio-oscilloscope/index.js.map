{"version":3,"names":["isFunction","v","result","AudioOscilloscope","constructor","canvas","options","draw","canvasOptions","canvasContextOptions","canvasContext","analyser","bufferLength","dataArray","width","height","getContext","fillStyle","strokeStyle","lineWidth","onDrawFrame","addSource","streamSource","audioContext","context","createAnalyser","fftSize","frequencyBinCount","source","createBufferSource","Uint8Array","getByteTimeDomainData","connect","ctx","w","h","fillRect","beginPath","sliceWidth","x","moveTo","i","y","lineTo","stroke","requestAnimationFrame"],"sources":["index.js"],"sourcesContent":["function isFunction (v) {\n  return typeof v === 'function'\n}\n\nfunction result (v) {\n  return isFunction(v) ? v() : v\n}\n\n/* Audio Oscilloscope\n  https://github.com/miguelmota/audio-oscilloscope\n*/\nexport default class AudioOscilloscope {\n  constructor (canvas, options = {}) {\n    const canvasOptions = options.canvas || {}\n    const canvasContextOptions = options.canvasContext || {}\n    this.analyser = null\n    this.bufferLength = 0\n    this.dataArray = []\n    this.canvas = canvas\n    this.width = result(canvasOptions.width) || this.canvas.width\n    this.height = result(canvasOptions.height) || this.canvas.height\n    this.canvas.width = this.width\n    this.canvas.height = this.height\n    this.canvasContext = this.canvas.getContext('2d')\n    this.canvasContext.fillStyle = result(canvasContextOptions.fillStyle) || 'rgb(255, 255, 255)'\n    this.canvasContext.strokeStyle = result(canvasContextOptions.strokeStyle) || 'rgb(0, 0, 0)'\n    this.canvasContext.lineWidth = result(canvasContextOptions.lineWidth) || 1\n    this.onDrawFrame = isFunction(options.onDrawFrame) ? options.onDrawFrame : () => {}\n  }\n\n  addSource (streamSource) {\n    this.streamSource = streamSource\n    this.audioContext = this.streamSource.context\n    this.analyser = this.audioContext.createAnalyser()\n    this.analyser.fftSize = 2048\n    this.bufferLength = this.analyser.frequencyBinCount\n    this.source = this.audioContext.createBufferSource()\n    this.dataArray = new Uint8Array(this.bufferLength)\n    this.analyser.getByteTimeDomainData(this.dataArray)\n    this.streamSource.connect(this.analyser)\n  }\n\n  draw () {\n    const { analyser, dataArray, bufferLength } = this\n    const ctx = this.canvasContext\n    const w = this.width\n    const h = this.height\n\n    if (analyser) {\n      analyser.getByteTimeDomainData(dataArray)\n    }\n\n    ctx.fillRect(0, 0, w, h)\n    ctx.beginPath()\n\n    const sliceWidth = (w * 1.0) / bufferLength\n    let x = 0\n\n    if (!bufferLength) {\n      ctx.moveTo(0, this.height / 2)\n    }\n\n    for (let i = 0; i < bufferLength; i++) {\n      const v = dataArray[i] / 128.0\n      const y = v * (h / 2)\n\n      if (i === 0) {\n        ctx.moveTo(x, y)\n      } else {\n        ctx.lineTo(x, y)\n      }\n\n      x += sliceWidth\n    }\n\n    ctx.lineTo(w, h / 2)\n    ctx.stroke()\n\n    this.onDrawFrame(this)\n    requestAnimationFrame(this.#draw)\n  }\n\n  #draw = () => this.draw()\n}\n"],"mappings":"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"}