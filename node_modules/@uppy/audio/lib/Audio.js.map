{"version":3,"names":["h","UIPlugin","getFileTypeExtension","supportsMediaRecorder","RecordingScreen","PermissionsScreen","locale","packageJson","Audio","constructor","uppy","opts","options","Promise","reject","Error","then","hasAudio","setPluginState","getUserMedia","audio","stream","currentDeviceId","tracks","getAudioTracks","deviceId","getSettings","forEach","track","audioReady","catch","err","cameraError","info","message","MediaRecorder","stoppingBecauseOfMaxSize","addEventListener","event","push","data","restrictions","length","maxFileSize","totalSize","reduce","acc","chunk","size","averageChunkSize","expectedEndChunkSize","maxSize","Math","max","i18n","start","recordingLengthTimer","setInterval","currentRecordingLength","getPluginState","recordingLengthSeconds","isRecording","stopped","resolve","stop","clearInterval","file","recordedAudio","URL","createObjectURL","isRestriction","log","error","addFile","audioTracks","once","enumerateDevices","devices","audioSources","filter","device","kind","navigator","mediaDevices","id","type","icon","defaultLocale","i18nInit","title","render","audioState","showAudioSourceDropdown","install","target","mount","ondevicechange","restartStream","audioSource","uninstall","unmount","some","mimeType","find","blob","fileExtension","name","Date","now","Blob","source","VERSION","version"],"sources":["Audio.jsx"],"sourcesContent":["import { h } from 'preact'\n\nimport { UIPlugin } from '@uppy/core'\n\nimport getFileTypeExtension from '@uppy/utils/lib/getFileTypeExtension'\nimport supportsMediaRecorder from './supportsMediaRecorder.js'\nimport RecordingScreen from './RecordingScreen.jsx'\nimport PermissionsScreen from './PermissionsScreen.jsx'\nimport locale from './locale.js'\n\nimport packageJson from '../package.json'\n\n/**\n * Audio recording plugin\n */\nexport default class Audio extends UIPlugin {\n  static VERSION = packageJson.version\n\n  #stream = null\n\n  #audioActive = false\n\n  #recordingChunks = null\n\n  #recorder = null\n\n  #capturedMediaFile = null\n\n  #mediaDevices = null\n\n  #supportsUserMedia = null\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.#mediaDevices = navigator.mediaDevices\n    this.#supportsUserMedia = this.#mediaDevices != null\n    this.id = this.opts.id || 'Audio'\n    this.type = 'acquirer'\n    this.icon = () => (\n      <svg className=\"uppy-DashboardTab-iconAudio\" aria-hidden=\"true\" focusable=\"false\" width=\"32px\" height=\"32px\" viewBox=\"0 0 32 32\">\n        <path d=\"M21.143 12.297c.473 0 .857.383.857.857v2.572c0 3.016-2.24 5.513-5.143 5.931v2.64h2.572a.857.857 0 110 1.714H12.57a.857.857 0 110-1.714h2.572v-2.64C12.24 21.24 10 18.742 10 15.726v-2.572a.857.857 0 111.714 0v2.572A4.29 4.29 0 0016 20.01a4.29 4.29 0 004.286-4.285v-2.572c0-.474.384-.857.857-.857zM16 6.5a3 3 0 013 3v6a3 3 0 01-6 0v-6a3 3 0 013-3z\" fill=\"currentcolor\" fill-rule=\"nonzero\" />\n      </svg>\n    )\n\n    this.defaultLocale = locale\n\n    this.opts = { ...opts }\n\n    this.i18nInit()\n    this.title = this.i18n('pluginNameAudio')\n\n    this.setPluginState({\n      hasAudio: false,\n      audioReady: false,\n      cameraError: null,\n      recordingLengthSeconds: 0,\n      audioSources: [],\n      currentDeviceId: null,\n    })\n  }\n\n  #hasAudioCheck () {\n    if (!this.#mediaDevices) {\n      return Promise.resolve(false)\n    }\n\n    return this.#mediaDevices.enumerateDevices().then(devices => {\n      return devices.some(device => device.kind === 'audioinput')\n    })\n  }\n\n  // eslint-disable-next-line consistent-return\n  #start = (options = null) => {\n    if (!this.#supportsUserMedia) {\n      return Promise.reject(new Error('Microphone access not supported'))\n    }\n\n    this.#audioActive = true\n\n    this.#hasAudioCheck().then(hasAudio => {\n      this.setPluginState({\n        hasAudio,\n      })\n\n      // ask user for access to their camera\n      return this.#mediaDevices.getUserMedia({ audio: true })\n        .then((stream) => {\n          this.#stream = stream\n\n          let currentDeviceId = null\n          const tracks = stream.getAudioTracks()\n\n          if (!options || !options.deviceId) {\n            currentDeviceId = tracks[0].getSettings().deviceId\n          } else {\n            tracks.forEach((track) => {\n              if (track.getSettings().deviceId === options.deviceId) {\n                currentDeviceId = track.getSettings().deviceId\n              }\n            })\n          }\n\n          // Update the sources now, so we can access the names.\n          this.#updateSources()\n\n          this.setPluginState({\n            currentDeviceId,\n            audioReady: true,\n          })\n        })\n        .catch((err) => {\n          this.setPluginState({\n            audioReady: false,\n            cameraError: err,\n          })\n          this.uppy.info(err.message, 'error')\n        })\n    })\n  }\n\n  #startRecording = () => {\n    // only used if supportsMediaRecorder() returned true\n    // eslint-disable-next-line compat/compat\n    this.#recorder = new MediaRecorder(this.#stream)\n    this.#recordingChunks = []\n    let stoppingBecauseOfMaxSize = false\n    this.#recorder.addEventListener('dataavailable', (event) => {\n      this.#recordingChunks.push(event.data)\n\n      const { restrictions } = this.uppy.opts\n      if (this.#recordingChunks.length > 1\n          && restrictions.maxFileSize != null\n          && !stoppingBecauseOfMaxSize) {\n        const totalSize = this.#recordingChunks.reduce((acc, chunk) => acc + chunk.size, 0)\n        // Exclude the initial chunk from the average size calculation because it is likely to be a very small outlier\n        const averageChunkSize = (totalSize - this.#recordingChunks[0].size) / (this.#recordingChunks.length - 1)\n        const expectedEndChunkSize = averageChunkSize * 3\n        const maxSize = Math.max(0, restrictions.maxFileSize - expectedEndChunkSize)\n\n        if (totalSize > maxSize) {\n          stoppingBecauseOfMaxSize = true\n          this.uppy.info(this.i18n('recordingStoppedMaxSize'), 'warning', 4000)\n          this.#stopRecording()\n        }\n      }\n    })\n\n    // use a \"time slice\" of 500ms: ondataavailable will be called each 500ms\n    // smaller time slices mean we can more accurately check the max file size restriction\n    this.#recorder.start(500)\n\n    // Start the recordingLengthTimer if we are showing the recording length.\n    this.recordingLengthTimer = setInterval(() => {\n      const currentRecordingLength = this.getPluginState().recordingLengthSeconds\n      this.setPluginState({ recordingLengthSeconds: currentRecordingLength + 1 })\n    }, 1000)\n\n    this.setPluginState({\n      isRecording: true,\n    })\n  }\n\n  #stopRecording = () => {\n    const stopped = new Promise((resolve) => {\n      this.#recorder.addEventListener('stop', () => {\n        resolve()\n      })\n      this.#recorder.stop()\n\n      clearInterval(this.recordingLengthTimer)\n      this.setPluginState({ recordingLengthSeconds: 0 })\n    })\n\n    return stopped.then(() => {\n      this.setPluginState({\n        isRecording: false,\n      })\n      return this.#getAudio()\n    }).then((file) => {\n      try {\n        this.#capturedMediaFile = file\n        // create object url for capture result preview\n        this.setPluginState({\n          recordedAudio: URL.createObjectURL(file.data),\n        })\n      } catch (err) {\n        // Logging the error, exept restrictions, which is handled in Core\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n      }\n    }).then(() => {\n      this.#recordingChunks = null\n      this.#recorder = null\n    }, (error) => {\n      this.#recordingChunks = null\n      this.#recorder = null\n      throw error\n    })\n  }\n\n  #discardRecordedAudio = () => {\n    this.setPluginState({ recordedAudio: null })\n    this.#capturedMediaFile = null\n  }\n\n  #submit = () => {\n    try {\n      if (this.#capturedMediaFile) {\n        this.uppy.addFile(this.#capturedMediaFile)\n      }\n    } catch (err) {\n      // Logging the error, exept restrictions, which is handled in Core\n      if (!err.isRestriction) {\n        this.uppy.log(err, 'warning')\n      }\n    }\n  }\n\n  #stop = async () => {\n    if (this.#stream) {\n      const audioTracks = this.#stream.getAudioTracks()\n      audioTracks.forEach((track) => track.stop())\n    }\n\n    if (this.#recorder) {\n      await new Promise((resolve) => {\n        this.#recorder.addEventListener('stop', resolve, { once: true })\n        this.#recorder.stop()\n\n        clearInterval(this.recordingLengthTimer)\n      })\n    }\n\n    this.#recordingChunks = null\n    this.#recorder = null\n    this.#audioActive = false\n    this.#stream = null\n\n    this.setPluginState({\n      recordedAudio: null,\n      isRecording: false,\n      recordingLengthSeconds: 0,\n    })\n  }\n\n  #getAudio () {\n    // Sometimes in iOS Safari, Blobs (especially the first Blob in the recordingChunks Array)\n    // have empty 'type' attributes (e.g. '') so we need to find a Blob that has a defined 'type'\n    // attribute in order to determine the correct MIME type.\n    const mimeType = this.#recordingChunks.find(blob => blob.type?.length > 0).type\n\n    const fileExtension = getFileTypeExtension(mimeType)\n\n    if (!fileExtension) {\n      return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type \"${mimeType}\"`))\n    }\n\n    const name = `audio-${Date.now()}.${fileExtension}`\n    const blob = new Blob(this.#recordingChunks, { type: mimeType })\n    const file = {\n      source: this.id,\n      name,\n      data: new Blob([blob], { type: mimeType }),\n      type: mimeType,\n    }\n\n    return Promise.resolve(file)\n  }\n\n  #changeSource = (deviceId) => {\n    this.#stop()\n    this.#start({ deviceId })\n  }\n\n  #updateSources = () => {\n    this.#mediaDevices.enumerateDevices().then(devices => {\n      this.setPluginState({\n        audioSources: devices.filter((device) => device.kind === 'audioinput'),\n      })\n    })\n  }\n\n  render () {\n    if (!this.#audioActive) {\n      this.#start()\n    }\n\n    const audioState = this.getPluginState()\n\n    if (!audioState.audioReady || !audioState.hasAudio) {\n      return (\n        <PermissionsScreen\n          icon={this.icon}\n          i18n={this.i18n}\n          hasAudio={audioState.hasAudio}\n        />\n      )\n    }\n\n    return (\n      <RecordingScreen\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...audioState}\n        audioActive={this.#audioActive}\n        onChangeSource={this.#changeSource}\n        onStartRecording={this.#startRecording}\n        onStopRecording={this.#stopRecording}\n        onDiscardRecordedAudio={this.#discardRecordedAudio}\n        onSubmit={this.#submit}\n        onStop={this.#stop}\n        i18n={this.i18n}\n        showAudioSourceDropdown={this.opts.showAudioSourceDropdown}\n        supportsRecording={supportsMediaRecorder()}\n        recording={audioState.isRecording}\n        stream={this.#stream}\n      />\n    )\n  }\n\n  install () {\n    this.setPluginState({\n      audioReady: false,\n      recordingLengthSeconds: 0,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n\n    if (this.#mediaDevices) {\n      this.#updateSources()\n\n      this.#mediaDevices.ondevicechange = () => {\n        this.#updateSources()\n\n        if (this.#stream) {\n          let restartStream = true\n\n          const { audioSources, currentDeviceId } = this.getPluginState()\n\n          audioSources.forEach((audioSource) => {\n            if (currentDeviceId === audioSource.deviceId) {\n              restartStream = false\n            }\n          })\n\n          if (restartStream) {\n            this.#stop()\n            this.#start()\n          }\n        }\n      }\n    }\n  }\n\n  uninstall () {\n    if (this.#stream) {\n      this.#stop()\n    }\n\n    this.unmount()\n  }\n}\n"],"mappings":"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"}