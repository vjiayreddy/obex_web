{"version":3,"names":["BasePlugin","findDOMElement","toArray","getFormData","packageJson","Form","constructor","uppy","opts","type","id","title","defaultOptions","target","resultName","getMetaFromForm","addResultToForm","submitOnSuccess","triggerUploadOnSubmit","handleFormSubmit","bind","handleUploadStart","handleSuccess","result","form","submit","ev","preventDefault","elements","disabledByUppy","forEach","el","isButton","tagName","disabled","push","upload","then","button","err","Promise","reject","catch","log","stack","message","resultInput","querySelector","updatedResult","JSON","parse","value","Array","isArray","stringify","document","createElement","name","appendChild","formMeta","setMeta","install","nodeName","addEventListener","on","uninstall","removeEventListener","off","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport findDOMElement from '@uppy/utils/lib/findDOMElement'\nimport toArray from '@uppy/utils/lib/toArray'\n\nimport getFormData from 'get-form-data'\n\nimport packageJson from '../package.json'\n\n/**\n * Form\n */\nexport default class Form extends BasePlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'Form'\n    this.title = 'Form'\n\n    // set default options\n    const defaultOptions = {\n      target: null,\n      resultName: 'uppyResult',\n      getMetaFromForm: true,\n      addResultToForm: true,\n      submitOnSuccess: false,\n      triggerUploadOnSubmit: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.handleFormSubmit = this.handleFormSubmit.bind(this)\n    this.handleUploadStart = this.handleUploadStart.bind(this)\n    this.handleSuccess = this.handleSuccess.bind(this)\n    this.addResultToForm = this.addResultToForm.bind(this)\n    this.getMetaFromForm = this.getMetaFromForm.bind(this)\n  }\n\n  handleUploadStart () {\n    if (this.opts.getMetaFromForm) {\n      this.getMetaFromForm()\n    }\n  }\n\n  handleSuccess (result) {\n    if (this.opts.addResultToForm) {\n      this.addResultToForm(result)\n    }\n\n    if (this.opts.submitOnSuccess) {\n      this.form.submit()\n    }\n  }\n\n  handleFormSubmit (ev) {\n    if (this.opts.triggerUploadOnSubmit) {\n      ev.preventDefault()\n      const elements = toArray(ev.target.elements)\n      const disabledByUppy = []\n      elements.forEach((el) => {\n        const isButton = el.tagName === 'BUTTON' || (el.tagName === 'INPUT' && el.type === 'submit')\n        if (isButton && !el.disabled) {\n          el.disabled = true // eslint-disable-line no-param-reassign\n          disabledByUppy.push(el)\n        }\n      })\n      this.uppy.upload().then(() => {\n        disabledByUppy.forEach((button) => {\n          button.disabled = false // eslint-disable-line no-param-reassign\n        })\n      }, (err) => {\n        disabledByUppy.forEach((button) => {\n          button.disabled = false // eslint-disable-line no-param-reassign\n        })\n        return Promise.reject(err)\n      }).catch((err) => {\n        this.uppy.log(err.stack || err.message || err)\n      })\n    }\n  }\n\n  addResultToForm (result) {\n    this.uppy.log('[Form] Adding result to the original form:')\n    this.uppy.log(result)\n\n    let resultInput = this.form.querySelector(`[name=\"${this.opts.resultName}\"]`)\n    if (resultInput) {\n      // Append new result to the previous result array.\n      // If the previous result is empty, or not an array,\n      // set it to an empty array.\n      let updatedResult\n      try {\n        updatedResult = JSON.parse(resultInput.value)\n      } catch (err) {\n        // Nothing, since we check for array below anyway\n      }\n\n      if (!Array.isArray(updatedResult)) {\n        updatedResult = []\n      }\n      updatedResult.push(result)\n      resultInput.value = JSON.stringify(updatedResult)\n      return\n    }\n\n    resultInput = document.createElement('input')\n    resultInput.name = this.opts.resultName\n    resultInput.type = 'hidden'\n    resultInput.value = JSON.stringify([result])\n\n    this.form.appendChild(resultInput)\n  }\n\n  getMetaFromForm () {\n    const formMeta = getFormData(this.form)\n    // We want to exclude meta the the Form plugin itself has added\n    // See https://github.com/transloadit/uppy/issues/1637\n    delete formMeta[this.opts.resultName]\n    this.uppy.setMeta(formMeta)\n  }\n\n  install () {\n    this.form = findDOMElement(this.opts.target)\n    if (!this.form || this.form.nodeName !== 'FORM') {\n      this.uppy.log('Form plugin requires a <form> target element passed in options to operate, none was found', 'error')\n      return\n    }\n\n    this.form.addEventListener('submit', this.handleFormSubmit)\n    this.uppy.on('upload', this.handleUploadStart)\n    this.uppy.on('complete', this.handleSuccess)\n  }\n\n  uninstall () {\n    this.form.removeEventListener('submit', this.handleFormSubmit)\n    this.uppy.off('upload', this.handleUploadStart)\n    this.uppy.off('complete', this.handleSuccess)\n  }\n}\n"],"mappings":"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"}